machine:
  timezone:
    GMT
  xcode:
    version: 8.0
  environment:
    XCODE_SCHEME: nupic
    XCODE_WORKSPACE: nupic
    ARCHFLAGS: "-arch x86_64"
    PATH: "$HOME/Library/Python/2.7/bin:$PATH"
    PYTHONPATH: "$HOME/Library/Python/2.7/lib/python/site-packages"
    PYBIN: "$HOME/Library/Python/2.7/bin"
  #pre:
  #pr- pip install --user --ignore-installed --upgrade --verbose virtualenv
  #pr- ln -s ~/Library/Python/2.7/bin/virtualenv /usr/local/bin/virtualenv

checkout:
  post:
    - rm -rf ~/.pyenv

dependencies:
  override:
    - pwd
    - ls -la $VIRTUAL_ENV/lib
    - ls -la $VIRTUAL_ENV/lib/python
    - echo $VIRTUAL_ENV
    - which pip
    - pip install -U pip
    - which pip
    - curl --silent --show-error --retry 5 -O http://releases.numenta.org/pip/1ebd3cb7a5a3073058d0c9552ab074bd/get-pip.py
    - python get-pip.py --user pip setuptools wheel
    - echo "$PATH"
    - echo "$PYTHONPATH"
    - echo "$PYBIN"
    - ls -la $HOME/Library/Python/2.7/lib/python/site-packages/
    - pip --version
    - PATH=$PYBIN:$PATH pip --version
    - PATH=$PYBIN:$PATH pip install --use-wheel --user -r bindings/py/requirements.txt --quiet || exit
    - PATH=$PYBIN:$PATH pip install --user pycapnp==0.5.8

#database:
compile:
  override:
    - mkdir -p build/scripts
    - cd build/scripts && cmake ../.. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../release -DPY_EXTENSIONS_DIR=../../bindings/py/nupic/bindings
test:
  override:
    - py.test tests/unit
    - py.test tests/integration
